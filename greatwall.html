<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>é•¿åŸ</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #005bbb;
    }
    .player-section {
      max-width: 700px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .controls, .pinyin-toggle, .subtitle-box, .question-section {
      margin-top: 20px;
    }
    .controls label {
      font-weight: bold;
    }
    .subtitle-box {
      background-color: #f0f0f0;
      padding: 15px;
      border-radius: 5px;
      font-size: 16px;
      line-height: 1.6;
    }
    .question {
      margin-top: 20px;
    }
    .options button {
      display: block;
      margin: 6px 0;
      padding: 8px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
    .options button.selected {
      background-color: #dceeff;
    }
    .options button.selected.correct {
      background-color: #c8f7c5;
    }
    .options button.selected.wrong {
      background-color: #f7c5c5;
    }
    .result-box {
      margin-top: 30px;
      padding: 15px;
      background-color: #e9f5ff;
      border-radius: 6px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>é•¿åŸ</h1>
  <div class="player-section">
    <audio id="audioPlayer" controls>
      <source src="audio/greatwall.mp3" type="audio/mpeg">
      æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>

    <div class="controls">
      <label for="speedRange">æ’­æ”¾é€Ÿåº¦ï¼š<span id="speedDisplay">1.00x</span></label><br>
      <input type="range" id="speedRange" min="0.5" max="2" step="0.05" value="1" oninput="updateSpeed(this.value)" />
    </div>

    <div class="pinyin-toggle">
      <button onclick="togglePinyin()">åˆ‡æ¢æ‹¼éŸ³æ˜¾ç¤º</button>
    </div>

    <div class="subtitle-box">
      <div id="subtitleText">ï¼ˆæ­¤å¤„å°†åŠ è½½å­—å¹•ï¼‰</div>
    </div>

    <div class="question-section">
      <h3>ğŸ“ å¬åŠ›ç†è§£ç»ƒä¹ </h3>

      <div class="question" id="q1">
        <p>1. é•¿åŸçš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
        <div class="options">
          <button onclick="selectOption(this, 'q1', 'A')">A. å•†ä¸šäº¤æµ</button>
          <button onclick="selectOption(this, 'q1', 'B')">B. å†œä¸šå‘å±•</button>
          <button onclick="selectOption(this, 'q1', 'C')">C. é˜²å¾¡æ•Œäºº</button>
          <button onclick="selectOption(this, 'q1', 'D')">D. äº¤é€šè¿è¾“</button>
        </div>
      </div>

      <div class="question" id="q2">
        <p>2. é•¿åŸè·¨è¶Šå“ªäº›åœ°ç†åŒºåŸŸï¼Ÿ</p>
        <div class="options">
          <button onclick="selectOption(this, 'q2', 'A')">A. é«˜å±±å’Œæ²™æ¼ </button>
          <button onclick="selectOption(this, 'q2', 'B')">B. å¹³åŸå’Œæ¹–æ³Š</button>
          <button onclick="selectOption(this, 'q2', 'C')">C. ä¸˜é™µå’Œè‰åŸ</button>
          <button onclick="selectOption(this, 'q2', 'D')">D. æ±Ÿæ²³å’Œæµ·æ´‹</button>
        </div>
      </div>

      <div class="question" id="q3">
        <p>3. æ¸¸å®¢ä¸ºä»€ä¹ˆå‚è§‚é•¿åŸï¼Ÿ</p>
        <div class="options">
          <button onclick="selectOption(this, 'q3', 'A')">A. ä½“éªŒæ–‡åŒ–</button>
          <button onclick="selectOption(this, 'q3', 'B')">B. è´­ç‰©æ—…æ¸¸</button>
          <button onclick="selectOption(this, 'q3', 'C')">C. å¯»æ‰¾äº²æˆš</button>
          <button onclick="selectOption(this, 'q3', 'D')">D. å­¦ä¹ å†œä¸š</button>
        </div>
      </div>

      <button onclick="submitAnswers()" style="margin-top: 30px; padding: 10px 20px; font-size: 16px;">æäº¤ç­”æ¡ˆ</button>

      <div class="result-box" id="resultBox" style="display:none;"></div>
    </div>
  </div>

  <script>
    function updateSpeed(rate) {
      const speed = parseFloat(rate);
      document.getElementById('audioPlayer').playbackRate = speed;
      document.getElementById('speedDisplay').innerText = speed.toFixed(2) + "x";
    }

    let showingPinyin = false;
    function togglePinyin() {
      fetch(showingPinyin ? 'subtitles/greatwall.txt' : 'subtitles/greatwall_pinyin.html')
        .then(res => res.text())
        .then(data => {
          const box = document.getElementById('subtitleText');
          showingPinyin ? box.innerText = data : box.innerHTML = data;
          showingPinyin = !showingPinyin;
        })
        .catch(() => {
          document.getElementById('subtitleText').innerText = 'ï¼ˆå­—å¹•åŠ è½½å¤±è´¥ï¼‰';
        });
    }

    window.onload = () => {
      fetch('subtitles/greatwall.txt')
        .then(res => res.text())
        .then(text => {
          document.getElementById('subtitleText').innerText = text;
        });
    };

    const correctAnswers = {
      q1: 'C',
      q2: 'A',
      q3: 'A'
    };

    const explanations = {
      q1: 'âœ… ç­”æ¡ˆï¼šC<br>ğŸ“˜ è§£æï¼šæ–‡ä¸­è¯´é•¿åŸæ˜¯ä¸­å›½å¤ä»£çš„é˜²å¾¡å·¥ç¨‹ã€‚',
      q2: 'âœ… ç­”æ¡ˆï¼šA<br>ğŸ“˜ è§£æï¼šæ–‡ä¸­æåˆ°é•¿åŸç©¿è¶Šé«˜å±±å’Œæ²™æ¼ ã€‚',
      q3: 'âœ… ç­”æ¡ˆï¼šA<br>ğŸ“˜ è§£æï¼šè®¸å¤šæ¸¸å®¢å‚è§‚é•¿åŸæ˜¯ä¸ºäº†ä½“éªŒä¸­åæ–‡åŒ–ã€‚'
    };

    const userAnswers = {};

    function selectOption(button, questionId, selectedOption) {
      userAnswers[questionId] = selectedOption;
      const buttons = button.parentElement.querySelectorAll('button');
      buttons.forEach(btn => btn.classList.remove('selected'));
      button.classList.add('selected');
    }

    function submitAnswers() {
      let correct = 0;
      let total = 0;
      let wrongList = [];
      let html = '';

      for (const qid in correctAnswers) {
        total++;
        const correctAnswer = correctAnswers[qid];
        const userAnswer = userAnswers[qid];

        const questionEl = document.getElementById(qid);
        const buttons = questionEl.querySelectorAll('button');
        buttons.forEach(btn => {
          btn.disabled = true;
          const opt = btn.innerText.charAt(0);
          if (opt === correctAnswer) btn.classList.add('correct');
          if (opt === userAnswer && userAnswer !== correctAnswer) btn.classList.add('wrong');
        });

        if (userAnswer === correctAnswer) {
          correct++;
        } else {
          wrongList.push(qid.toUpperCase().replace('Q', 'ç¬¬') + 'é¢˜');
        }
      }

      html += `<p>âœ… å…±ç­”å¯¹ ${correct}/${total} é¢˜ï¼Œæ­£ç¡®ç‡ ${(correct / total * 100).toFixed(0)}%</p>`;
      if (wrongList.length > 0) {
        html += `<p>âŒ ç­”é”™é¢˜ç›®ï¼š${wrongList.join('ï¼Œ')}</p>`;
      }
      html += '<hr>';
      for (const qid in explanations) {
        html += `<p><strong>${qid.toUpperCase().replace('Q', 'ç¬¬')}é¢˜</strong><br>${explanations[qid]}</p>`;
      }

      const resultBox = document.getElementById('resultBox');
      resultBox.innerHTML = html;
      resultBox.style.display = 'block';
    }
  </script>
</body>
</html>
